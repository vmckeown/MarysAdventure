import { Graphics } from "./graphics.js";
import { trees, houses } from "./main.js";

export const TILE_SIZE = 32;
export const WORLD_COLS = 50;
export const WORLD_ROWS = 50;
export const BACKGROUND_COLOR = "#333";
const TILES_PER_ROW = 10;

export const tileImage = new Image();
    tileImage.src = "./pics/background.png";
    tileImage.onload = () => {
    console.log("âœ… Tile image loaded");
};

export const backgroundImage = new Image();
backgroundImage.src = "./pics/background.png";
export const houseImage = new Image();
houseImage.src = "./pics/house.png";


let isImageLoaded = false;
backgroundImage.onload = () => {
    isImageLoaded = true;
};


export const world = []

const TILE_INDEX = {
    TL_CORNER: 0,
    TR_CORNER: 1,
    VERTICAL: 2,
    BL_CORNER: 3,
    HORIZONTAL: 4,
    BR_CORNER: 5,
    H_LEFT_END: 6,
    H_RIGHT_END: 7,
    GRASS0: 10,
    GRASS1: 11,
    GRASS2: 12,
    GRASS3: 13,
    GRASS4: 14,
    GRASS5: 15,
    GRASS6: 16,
    GRASS7: 17,
    GRASS8: 18,
    WATER: 20,
    LAKE: 24,

};

export const SOLID_TILES = [0, 1, 2, 3, 4, 5, 6, 7, 18, 20, 24]; 
const ANIMATED_TILES = {
    20: { frames: [20, 21, 22, 23], speed: 0.2 } // Frame indexes for animation, frame duration
};

let animationTimer = 0;
let animationFrame = 0;

export const worldMap = [
  [10, 11, 12, 13, 14, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 16, 20, 17, 11, 10, 14, 13, 15, 15, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 13, 12],
  [11, 12, 13, 14, 15, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 16, 20, 17, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 11],
  [12, 13, 14, 15, 14, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 16, 20, 17, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 10, 11],
  [13, 14, 15, 14, 10, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 16, 20, 17, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 11, 11],
  [14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 16, 20, 17, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 12],
  [15, 14, 10, 11, 12, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 16, 20, 17, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 13, 14, 14],
  [14, 10, 11, 12, 13, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 16, 20, 17, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 14, 15, 10],
  [10, 12, 14, 11, 15, 13, 14, 10, 14, 12, 11, 15, 10, 13, 14, 14, 12, 11, 15, 16, 20, 17, 14, 12, 11, 15, 10, 14, 13, 14, 12, 11, 15, 10, 14, 13, 14, 12, 11, 15, 10, 14, 13, 14, 12, 11, 15, 10, 14, 13],
  [11, 13, 15, 12, 14, 14, 10, 11, 15, 13, 12, 14, 11, 14, 15, 10, 13, 12, 14, 16, 20, 17, 10, 13, 12, 14, 11, 15, 14, 10, 13, 12, 14, 11, 15, 14, 10, 13, 12, 14, 11, 15, 14, 10, 13, 12, 14, 11, 11, 10],
  [12, 14, 14, 13, 10, 15, 11, 12, 14, 14, 13, 10, 12, 15, 14, 11, 14, 13, 10, 16, 20, 17, 11, 14, 13, 10, 12, 14, 15, 11, 14, 13, 10, 12, 14, 15, 11, 14, 13, 10, 12, 14, 15, 11, 14, 13, 10, 12, 14, 15],
//10
  [10, 11, 12, 13, 14, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 16, 20, 17, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 10, 11],
  [11, 12, 13, 14, 15, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 16, 20, 17, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 11, 10],
  [12, 13, 14, 15, 14, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 16, 20, 17, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 12, 14],
  [13, 14, 15, 14, 10, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 16, 20, 17, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 10, 11],
  [14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 16, 20, 17, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 12],
  [18, 15, 10, 14, 11, 14, 12, 13, 10, 15, 14, 11, 13, 14, 10, 12, 15, 14, 11, 16, 20, 17, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14],
  [24, 17, 11, 15, 12, 10, 13, 14, 11, 14, 15, 12, 14, 10, 11, 13, 14, 15, 12, 16, 20, 17, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10],
  [24, 17, 12, 14, 13, 11, 14, 15, 12, 10, 14, 13, 15, 11, 12, 14, 10, 14, 13, 16, 20, 17, 14, 10, 14, 13, 15, 12, 11, 14, 10, 14, 13, 15, 12, 11, 14, 10, 14, 13, 15, 12, 11, 14, 10, 14, 13, 15, 10, 11],
  [24, 17, 13, 10, 14, 12, 15, 14, 13, 11, 10, 14, 14, 12, 13, 15, 11, 10, 14, 16, 20, 17, 15, 11, 10, 14, 14, 13, 12, 15, 11, 10, 14, 14, 13, 12, 15, 11, 10, 14, 14, 13, 12, 15, 11, 10, 14, 14, 13, 12],
  [24, 17, 11, 15, 12, 10, 13, 14, 11, 14, 15, 12, 14, 10, 11, 13, 14, 15, 12, 16, 20, 17, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10],
//20
  [24, 17, 12, 13, 14, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 16, 20, 17, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 11, 13],
  [24, 17, 13, 14, 15, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 16, 20, 17, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 11, 10],
  [24, 17, 14, 15, 14, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 16, 20, 17, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 10, 13],
  [24, 17, 15, 14, 10, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 16, 20, 17, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 10],
  [24, 17, 14, 10, 11, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 16, 20, 17, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 11],
  [24, 17, 10, 11, 12, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 16, 20, 17, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10],
  [24, 17, 11, 12, 13, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 16, 20, 17, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11],
  [24, 17, 14, 11, 15, 13, 14, 10, 14, 12, 11, 15, 10, 13, 14, 14, 12, 11, 15, 16, 20, 17, 14, 12, 11, 15, 10, 14, 13, 14, 12, 11, 15, 10, 14, 13, 14, 12, 11, 15, 10, 14, 13, 14, 12, 11, 15, 10, 14, 13],
  [24, 17, 15, 12, 14, 14, 10, 11, 15, 13, 12, 14, 11, 14, 15, 10, 13, 12, 14, 16, 20, 17, 10, 13, 12, 14, 11, 15, 14, 10, 13, 12, 14, 11, 15, 14, 10, 13, 12, 14, 11, 15, 14, 10, 13, 12, 14, 11, 15, 14],
  [24, 17, 14, 13, 10, 15, 11, 12, 14, 14, 13, 10, 12, 15, 14, 11, 14, 13, 10, 16, 20, 17, 11, 14, 13, 10, 12, 14, 15, 11, 14, 13, 10, 12, 14, 15, 11, 14, 13, 10, 12, 14, 15, 11, 14, 13, 10, 12, 14, 15], 
//30 
  [24, 17, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 16, 20, 17, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 11, 10], 
  [24, 17, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 16, 20, 17, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 12, 11],
  [24, 17, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 16, 20, 17, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 14, 13],
  [24, 17, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 16, 20, 17, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 13, 14],
  [24, 17, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 16, 20, 17, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 10, 13],
  [24, 17, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 16, 20, 17, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10],
  [24, 17, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 10, 11, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 12, 10],
  [24, 17, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 10, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12],
  [24, 17, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 16, 20, 17, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13],
  [24, 17, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 16, 20, 17, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 14, 11],
//40
  [24, 17, 12, 13, 14, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 16, 20, 17, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 11, 10],
  [24, 17, 13, 14, 15, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 16, 20, 17, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 14],
  [24, 17, 14, 15, 14, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 16, 20, 17, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 13, 11],
  [24, 17, 15, 14, 10, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 16, 20, 17, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 14, 10],
  [24, 17, 14, 10, 11, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 16, 20, 17, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 12],
  [24, 17, 10, 14, 11, 14, 12, 13, 10, 15, 14, 11, 13, 14, 10, 12, 15, 14, 11, 16, 20, 17, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14],
  [24, 17, 11, 15, 12, 10, 13, 14, 11, 14, 15, 12, 14, 10, 11, 13, 14, 15, 12, 16, 20, 17, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10],
  [24, 17, 12, 14, 13, 11, 14, 15, 12, 10, 14, 13, 15, 11, 12, 14, 10, 14, 13, 16, 20, 17, 14, 10, 14, 13, 15, 12, 11, 14, 10, 14, 13, 15, 12, 11, 14, 10, 14, 13, 15, 12, 11, 14, 10, 14, 13, 15, 13, 14],
  [24, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 20, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18],
  [24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24],

];

export const worldMap_01 = [
  [10, 11, 12, 13, 14, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 16, 20, 17, 11, 10, 14, 13, 15, 15, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 13, 12],
  [11, 12, 13, 14, 15, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 16, 20, 17, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 11],
  [12, 13, 14, 15, 14, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 16, 20, 17, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 10, 11],
  [13, 14, 15, 14, 10, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 16, 20, 17, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 11, 11],
  [14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 16, 20, 17, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 12],
  [15, 14, 10, 11, 12, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 16, 20, 17, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 13, 14, 14],
  [14, 10, 11, 12, 13, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 16, 20, 17, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 14, 15, 10],
  [10, 12, 14, 11, 15, 13, 14, 10, 14, 12, 11, 15, 10, 13, 14, 14, 12, 11, 15, 16, 20, 17, 14, 12, 11, 15, 10, 14, 13, 14, 12, 11, 15, 10, 14, 13, 14, 12, 11, 15, 10, 14, 13, 14, 12, 11, 15, 10, 14, 13],
  [11, 13, 15, 12, 14, 14, 10, 11, 15, 13, 12, 14, 11, 14, 15, 10, 13, 12, 14, 16, 20, 17, 10, 13, 12, 14, 11, 15, 14, 10, 13, 12, 14, 11, 15, 14, 10, 13, 12, 14, 11, 15, 14, 10, 13, 12, 14, 11, 11, 10],
  [12, 14, 14, 13, 10, 15, 11, 12, 14, 14, 13, 10, 12, 15, 14, 11, 14, 13, 10, 16, 20, 17, 11, 14, 13, 10, 12, 14, 15, 11, 14, 13, 10, 12, 14, 15, 11, 14, 13, 10, 12, 14, 15, 11, 14, 13, 10, 12, 14, 15],
//10
  [10, 11, 12, 13, 14, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 16, 20, 17, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 10, 11],
  [11, 12, 13, 14, 15, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 16, 20, 17, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 11, 10],
  [12, 13, 14, 15, 14, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 16, 20, 17, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 12, 14],
  [13, 14, 15, 14, 10, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 16, 20, 17, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 10, 11],
  [14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 16, 20, 17, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 12],
  [18, 15, 10, 14, 11, 14, 12, 13, 10, 15, 14, 11, 13, 14, 10, 12, 15, 14, 11, 16, 20, 17, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14],
  [24, 17, 11, 15, 12, 10, 13, 14, 11, 14, 15, 12, 14, 10, 11, 13, 14, 15, 12, 16, 20, 17, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10],
  [24, 17, 12, 14, 13, 11, 14, 15, 12, 10, 14, 13, 15, 11, 12, 14, 10, 14, 13, 16, 20, 17, 14, 10, 14, 13, 15, 12, 11, 14, 10, 14, 13, 15, 12, 11, 14, 10, 14, 13, 15, 12, 11, 14, 10, 14, 13, 15, 10, 11],
  [24, 17, 13, 10, 14, 12, 15, 14, 13, 11, 10, 14, 14, 12, 13, 15, 11, 10, 14, 16, 20, 17, 15, 11, 10, 14, 14, 13, 12, 15, 11, 10, 14, 14, 13, 12, 15, 11, 10, 14, 14, 13, 12, 15, 11, 10, 14, 14, 13, 12],
  [24, 17, 11, 15, 12, 10, 13, 14, 11, 14, 15, 12, 14, 10, 11, 13, 14, 15, 12, 16, 20, 17, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10],
//20
  [24, 17, 12, 13, 14, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 16, 20, 17, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 11, 13],
  [24, 17, 13, 14, 15, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 16, 20, 17, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 11, 10],
  [24, 17, 14, 15, 14, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 16, 20, 17, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 10, 13],
  [24, 17, 15, 14, 10, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 16, 20, 17, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 10],
  [24, 17, 14, 10, 11, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 16, 20, 17, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 11],
  [24, 17, 10, 11, 12, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 16, 20, 17, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10],
  [24, 17, 11, 12, 13, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 16, 20, 17, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11],
  [24, 17, 14, 11, 15, 13, 14, 10, 14, 12, 11, 15, 10, 13, 14, 14, 12, 11, 15, 16, 20, 17, 14, 12, 11, 15, 10, 14, 13, 14, 12, 11, 15, 10, 14, 13, 14, 12, 11, 15, 10, 14, 13, 14, 12, 11, 15, 10, 14, 13],
  [24, 17, 15, 12, 14, 14, 10, 11, 15, 13, 12, 14, 11, 14, 15, 10, 13, 12, 14, 16, 20, 17, 10, 13, 12, 14, 11, 15, 14, 10, 13, 12, 14, 11, 15, 14, 10, 13, 12, 14, 11, 15, 14, 10, 13, 12, 14, 11, 15, 14],
  [24, 17, 14, 13, 10, 15, 11, 12, 14, 14, 13, 10, 12, 15, 14, 11, 14, 13, 10, 16, 20, 17, 11, 14, 13, 10, 12, 14, 15, 11, 14, 13, 10, 12, 14, 15, 11, 14, 13, 10, 12, 14, 15, 11, 14, 13, 10, 12, 14, 15], 
//30 
  [24, 17, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 16, 20, 17, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 11, 10], 
  [24, 17, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 16, 20, 17, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 12, 11],
  [24, 17, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 16, 20, 17, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 14, 13],
  [24, 17, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 16, 20, 17, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 13, 14],
  [24, 17, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 16, 20, 17, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 10, 13],
  [24, 17, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 16, 20, 17, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10],
  [24, 17, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 10, 11, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 12, 10],
  [24, 17, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 10, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12],
  [24, 17, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 16, 20, 17, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13],
  [24, 17, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 16, 20, 17, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 14, 11],
//40
  [24, 17, 12, 13, 14, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 16, 20, 17, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 11, 10],
  [24, 17, 13, 14, 15, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 16, 20, 17, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 14],
  [24, 17, 14, 15, 14, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 16, 20, 17, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 13, 11],
  [24, 17, 15, 14, 10, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 16, 20, 17, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 14, 10],
  [24, 17, 14, 10, 11, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 16, 20, 17, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 12],
  [24, 17, 10, 14, 11, 14, 12, 13, 10, 15, 14, 11, 13, 14, 10, 12, 15, 14, 11, 16, 20, 17, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14],
  [24, 17, 11, 15, 12, 10, 13, 14, 11, 14, 15, 12, 14, 10, 11, 13, 14, 15, 12, 16, 20, 17, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10],
  [24, 17, 15, 14, 10, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 16, 20, 17, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 14, 10],
  [24, 17, 14, 10, 11, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 16, 20, 17, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 12],
  [24, 17, 10, 14, 11, 14, 12, 13, 10, 15, 14, 11, 13, 14, 10, 12, 15, 14, 11, 16, 20, 17, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14]

];

export function setupWorld() {
    world.length = 0;

    for (let y = 0; y < WORLD_ROWS; y++) {
        const row = [];
        for (let x = 0; x < WORLD_COLS; x++) {
            if (y === 0 || y === WORLD_ROWS - 1 || x === 0 || x === WORLD_COLS - 1) {
                row.push(0); // wall tile
            } else {
                row.push(0); // ground tile
            }
        }
        world.push(row);
    }
}

export function updateWorldAnimation(dt) {
    animationTimer += dt;
    const frameDuration = 0.2; // Seconds per frame

    if (animationTimer >= frameDuration) {
        animationFrame = (animationFrame + 1) % 4; // Assuming 4 frames
        animationTimer = 0;
    }
}

export function drawWorld(ctx, camera) {
    const startCol = Math.floor(camera.x / TILE_SIZE);
    const endCol   = Math.ceil((camera.x + camera.width) / TILE_SIZE);
    const startRow = Math.floor(camera.y / TILE_SIZE);
    const endRow   = Math.ceil((camera.y + camera.height) / TILE_SIZE);
    if (!isImageLoaded) return; // skip drawing if image isn't ready

    for (let row = 0; row < WORLD_ROWS; row++) {
            for (let col = 0; col < WORLD_COLS; col++) {
                const tile = worldMap[row][col];
                let tileToDraw = tile;
                if (ANIMATED_TILES[tile]) {
                    const anim = ANIMATED_TILES[tile];

                    // Offset animation by tile position for natural flow
                    const offset = (row + col) % anim.frames.length;
                    tileToDraw = anim.frames[
                        (animationFrame + offset) % anim.frames.length
                    ];
                }

                const sx = (tileToDraw % TILES_PER_ROW) * TILE_SIZE;
                const sy = Math.floor(tileToDraw / TILES_PER_ROW) * TILE_SIZE;
                const dx = col * TILE_SIZE;
                const dy = row * TILE_SIZE;

                ctx.drawImage(tileImage, sx, sy, TILE_SIZE, TILE_SIZE, dx, dy, TILE_SIZE, TILE_SIZE);
            }
        }
    }

function checkBoxCollision(x, y, size, other) {
  const half = size / 2;

  return (
    x + half > other.x - other.size / 2 &&
    x - half < other.x + other.size / 2 &&
    y + half > other.y - other.size / 2 &&
    y - half < other.y + other.size / 2
  );
}

export function isColliding(x, y, size, npcs = [], objects = []) {
  // Tile collision
  if (isSolidTile(x, y, size)) return true;

  // Tree collision
  for (const tree of trees) {
    const b = tree.getCollisionBox();
    if (
      x + size / 2 > b.x &&
      x - size / 2 < b.x + b.width &&
      y + size / 2 > b.y &&
      y - size / 2 < b.y + b.height
    ) {
      return true;
    }
  }

  // houses
  for (const house of houses) {
  const b = house.getCollisionBox();
  if (
    x + size / 2 > b.x &&
    x - size / 2 < b.x + b.width &&
    y + size / 2 > b.y &&
    y - size / 2 < b.y + b.height
  ) {
    return true;
  }

   // ---- check solid objects (rocks, etc) ----
  for (const obj of objects) {
    if (!obj.solid || !obj.getCollisionBox) continue;

    const b = obj.getCollisionBox();

    if (
      x + size / 2 > b.x &&
      x - size / 2 < b.x + b.width &&
      y + size / 2 > b.y &&
      y - size / 2 < b.y + b.height
    ) {
      return true;
    }
  }

    return false;
  }


  // NPC collision
  for (const npc of npcs) {
    if (checkBoxCollision(x, y, size, npc)) {
        return true;
      }
    }

  return false;
}

export function isSolidTile(x, y, size) {
  const half = size / 2;

  const points = [
    { x: x - half, y: y - half },
    { x: x + half, y: y - half },
    { x: x - half, y: y + half },
    { x: x + half, y: y + half }
  ];

  for (const p of points) {
    const tx = Math.floor(p.x / TILE_SIZE);
    const ty = Math.floor(p.y / TILE_SIZE);

    const tile = getTile(tx, ty);
    if (SOLID_TILES.includes(tile)) {
      return true;
    }
  }

  return false;
}

export function getTile(tx, ty) {
    if (tx < 0 || ty < 0 || tx >= WORLD_COLS || ty >= WORLD_ROWS) return 1;
    return worldMap[ty][tx];
}

export function worldToTile(wx, wy) {
    return { x: Math.floor(wx / TILE_SIZE), y: Math.floor(wy / TILE_SIZE) };
}
