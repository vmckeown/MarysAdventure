import { Graphics } from "./graphics.js";
import { trees, houses } from "./main.js";

/* =========================
   CONSTANTS
========================= */

export const TILE_SIZE = 32;
export const WORLD_COLS = 50;
export const WORLD_ROWS = 50;
export const BACKGROUND_COLOR = "#333";
const TILES_PER_ROW = 10;

/* =========================
   IMAGES
========================= */

export const tileImage = new Image();
tileImage.src = "./pics/background.png";

let isImageLoaded = false;
tileImage.onload = () => {
  isImageLoaded = true;
};

export const backgroundImage = new Image();
backgroundImage.src = "./pics/background.png";

export const houseImage = new Image();
houseImage.src = "./pics/house.png";

/* =========================
   TILE INDEXES
========================= */

export const TILE_INDEX = {
  TL_CORNER: 0,
  TR_CORNER: 1,
  VERTICAL: 2,
  BL_CORNER: 3,
  HORIZONTAL: 4,
  BR_CORNER: 5,
  H_LEFT_END: 6,
  H_RIGHT_END: 7,

  GRASS0: 10,
  GRASS1: 11,
  GRASS2: 12,
  GRASS3: 13,
  GRASS4: 14,
  GRASS5: 15,
  GRASS6: 16,
  GRASS7: 17,
  GRASS8: 18,

  WATER: 20,
  LAKE: 24,

  // Dungeon tiles
  DUNGEON_BACK_L: 80,
  DUNGEON_BACK_M: 81,
  DUNGEON_BACK_R: 82,
  DUNGEON_SIDE_L: 83,
  DUNGEON_SIDE_R: 84,
  DUNGEON_FLOOR: 85,
  DUNGEON_FRONT: 93,
  DUNGEON_VOID: 94
};

/* =========================
   COLLISION
========================= */

export const SOLID_TILES = [
  0, 1, 2, 3, 4, 5, 6, 7, 20, 24,
  TILE_INDEX.DUNGEON_BACK_L,
  TILE_INDEX.DUNGEON_BACK_M,
  TILE_INDEX.DUNGEON_BACK_R,
  TILE_INDEX.DUNGEON_SIDE_L,
  TILE_INDEX.DUNGEON_SIDE_R,
  TILE_INDEX.DUNGEON_FRONT
];

/* =========================
   OVERWORLD MAPS
========================= */

export const worldMap = [
  [10, 11, 12, 13, 14, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 16, 20, 17, 11, 10, 14, 13, 15, 15, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 13, 12],
  [11, 12, 13, 14, 15, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 16, 20, 17, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 11],
  [12, 13, 14, 15, 14, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 16, 20, 17, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 10, 11],
  [13, 14, 15, 14, 10, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 16, 20, 17, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 11, 11],
  [14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 16, 20, 17, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 12],
  [15, 14, 10, 11, 12, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 16, 20, 17, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 13, 14, 14],
  [14, 10, 11, 12, 13, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 16, 20, 17, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 14, 15, 10],
  [10, 12, 14, 11, 15, 13, 14, 10, 14, 12, 11, 15, 10, 13, 14, 14, 12, 11, 15, 16, 20, 17, 14, 12, 11, 15, 10, 14, 13, 14, 12, 11, 15, 10, 14, 13, 14, 12, 11, 15, 10, 14, 13, 14, 12, 11, 15, 10, 14, 13],
  [11, 13, 15, 12, 14, 14, 10, 11, 15, 13, 12, 14, 11, 14, 15, 10, 13, 12, 14, 16, 20, 17, 10, 13, 12, 14, 11, 15, 14, 10, 13, 12, 14, 11, 15, 14, 10, 13, 12, 14, 11, 15, 14, 10, 13, 12, 14, 11, 11, 10],
  [12, 14, 14, 13, 10, 15, 11, 12, 14, 14, 13, 10, 12, 15, 14, 11, 14, 13, 10, 16, 20, 17, 11, 14, 13, 10, 12, 14, 15, 11, 14, 13, 10, 12, 14, 15, 11, 14, 13, 10, 12, 14, 15, 11, 14, 13, 10, 12, 14, 15],
//10
  [10, 11, 12, 13, 14, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 16, 20, 17, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 10, 11],
  [11, 12, 13, 14, 15, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 16, 20, 17, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 11, 10],
  [12, 13, 14, 15, 14, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 16, 20, 17, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 12, 14],
  [13, 14, 15, 14, 10, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 16, 20, 17, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 10, 11],
  [14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 16, 20, 17, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 12],
  [18, 15, 10, 14, 11, 14, 12, 13, 10, 15, 14, 11, 13, 14, 10, 12, 15, 14, 11, 16, 20, 17, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14],
  [24, 17, 11, 15, 12, 10, 13, 14, 11, 14, 15, 12, 14, 10, 11, 13, 14, 15, 12, 16, 20, 17, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10],
  [24, 17, 12, 14, 13, 11, 14, 15, 12, 10, 14, 13, 15, 11, 12, 14, 10, 14, 13, 16, 20, 17, 14, 10, 14, 13, 15, 12, 11, 14, 10, 14, 13, 15, 12, 11, 14, 10, 14, 13, 15, 12, 11, 14, 10, 14, 13, 15, 10, 11],
  [24, 17, 13, 10, 14, 12, 15, 14, 13, 11, 10, 14, 14, 12, 13, 15, 11, 10, 14, 16, 20, 17, 15, 11, 10, 14, 14, 13, 12, 15, 11, 10, 14, 14, 13, 12, 15, 11, 10, 14, 14, 13, 12, 15, 11, 10, 14, 14, 13, 12],
  [24, 17, 11, 15, 12, 10, 13, 14, 11, 14, 15, 12, 14, 10, 11, 13, 14, 15, 12, 16, 20, 17, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10],
//20
  [24, 17, 12, 13, 14, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 16, 20, 17, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 11, 13],
  [24, 17, 13, 14, 15, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 16, 20, 17, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 11, 10],
  [24, 17, 14, 15, 14, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 16, 20, 17, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 10, 13],
  [24, 17, 15, 14, 10, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 16, 20, 17, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 10],
  [24, 17, 14, 10, 11, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 16, 20, 17, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 11],
  [24, 17, 10, 11, 12, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 16, 20, 17, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10],
  [24, 17, 11, 12, 13, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 16, 20, 17, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11],
  [24, 17, 14, 11, 15, 13, 14, 10, 14, 12, 11, 15, 10, 13, 14, 14, 12, 11, 15, 16, 20, 17, 14, 12, 11, 15, 10, 14, 13, 14, 12, 11, 15, 10, 14, 13, 14, 12, 11, 15, 10, 14, 13, 14, 12, 11, 15, 10, 14, 13],
  [24, 17, 15, 12, 14, 14, 10, 11, 15, 13, 12, 14, 11, 14, 15, 10, 13, 12, 14, 16, 20, 17, 10, 13, 12, 14, 11, 15, 14, 10, 13, 12, 14, 11, 15, 14, 10, 13, 12, 14, 11, 15, 14, 10, 13, 12, 14, 11, 15, 14],
  [24, 17, 14, 13, 10, 15, 11, 12, 14, 14, 13, 10, 12, 15, 14, 11, 14, 13, 10, 16, 20, 17, 11, 14, 13, 10, 12, 14, 15, 11, 14, 13, 10, 12, 14, 15, 11, 14, 13, 10, 12, 14, 15, 11, 14, 13, 10, 12, 14, 15], 
//30 
  [24, 17, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 16, 20, 17, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 11, 10], 
  [24, 17, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 16, 20, 17, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 12, 11],
  [24, 17, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 16, 20, 17, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 14, 13],
  [24, 17, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 16, 20, 17, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 13, 14],
  [24, 17, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 16, 20, 17, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 10, 13],
  [24, 17, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 16, 20, 17, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10],
  [24, 17, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 10, 11, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 12, 10],
  [24, 17, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 10, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12],
  [24, 17, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 16, 20, 17, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13],
  [24, 17, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 16, 20, 17, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 14, 11],
//40
  [24, 17, 12, 13, 14, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 16, 20, 17, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 11, 10],
  [24, 17, 13, 14, 15, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 16, 20, 17, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 14],
  [24, 17, 14, 15, 14, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 16, 20, 17, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 13, 11],
  [24, 17, 15, 14, 10, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 16, 20, 17, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 14, 10],
  [24, 17, 14, 10, 11, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 16, 20, 17, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 12],
  [24, 17, 10, 14, 11, 14, 12, 13, 10, 15, 14, 11, 13, 14, 10, 12, 15, 14, 11, 16, 20, 17, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14],
  [24, 17, 11, 15, 12, 10, 13, 14, 11, 14, 15, 12, 14, 10, 11, 13, 14, 15, 12, 16, 20, 17, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10],
  [24, 17, 12, 14, 13, 11, 14, 15, 12, 10, 14, 13, 15, 11, 12, 14, 10, 14, 13, 16, 20, 17, 14, 10, 14, 13, 15, 12, 11, 14, 10, 14, 13, 15, 12, 11, 14, 10, 14, 13, 15, 12, 11, 14, 10, 14, 13, 15, 13, 14],
  [24, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 20, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18],
  [24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24],
];

export const worldMap_01 = [
  [10, 11, 12, 13, 14, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 16, 20, 17, 11, 10, 14, 13, 15, 15, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 13, 12],
  [11, 12, 13, 14, 15, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 16, 20, 17, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 11],
  [12, 13, 14, 15, 14, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 16, 20, 17, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 10, 11],
  [13, 14, 15, 14, 10, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 16, 20, 17, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 11, 11],
  [14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 16, 20, 17, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 12],
  [15, 14, 10, 11, 12, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 16, 20, 17, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 13, 14, 14],
  [14, 10, 11, 12, 13, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 16, 20, 17, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 14, 15, 10],
  [10, 12, 14, 11, 15, 13, 14, 10, 14, 12, 11, 15, 10, 13, 14, 14, 12, 11, 15, 16, 20, 17, 14, 12, 11, 15, 10, 14, 13, 14, 12, 11, 15, 10, 14, 13, 14, 12, 11, 15, 10, 14, 13, 14, 12, 11, 15, 10, 14, 13],
  [11, 13, 15, 12, 14, 14, 10, 11, 15, 13, 12, 14, 11, 14, 15, 10, 13, 12, 14, 16, 20, 17, 10, 13, 12, 14, 11, 15, 14, 10, 13, 12, 14, 11, 15, 14, 10, 13, 12, 14, 11, 15, 14, 10, 13, 12, 14, 11, 11, 10],
  [12, 14, 14, 13, 10, 15, 11, 12, 14, 14, 13, 10, 12, 15, 14, 11, 14, 13, 10, 16, 20, 17, 11, 14, 13, 10, 12, 14, 15, 11, 14, 13, 10, 12, 14, 15, 11, 14, 13, 10, 12, 14, 15, 11, 14, 13, 10, 12, 14, 15],
//10
  [10, 11, 12, 13, 14, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 16, 20, 17, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 10, 11],
  [11, 12, 13, 14, 15, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 16, 20, 17, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 11, 10],
  [12, 13, 14, 15, 14, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 16, 20, 17, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 12, 14],
  [13, 14, 15, 14, 10, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 16, 20, 17, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 10, 11],
  [14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 16, 20, 17, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 12],
  [18, 15, 10, 14, 11, 14, 12, 13, 10, 15, 14, 11, 13, 14, 10, 12, 15, 14, 11, 16, 20, 17, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14],
  [24, 17, 11, 15, 12, 10, 13, 14, 11, 14, 15, 12, 14, 10, 11, 13, 14, 15, 12, 16, 20, 17, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10],
  [24, 17, 12, 14, 13, 11, 14, 15, 12, 10, 14, 13, 15, 11, 12, 14, 10, 14, 13, 16, 20, 17, 14, 10, 14, 13, 15, 12, 11, 14, 10, 14, 13, 15, 12, 11, 14, 10, 14, 13, 15, 12, 11, 14, 10, 14, 13, 15, 10, 11],
  [24, 17, 13, 10, 14, 12, 15, 14, 13, 11, 10, 14, 14, 12, 13, 15, 11, 10, 14, 16, 20, 17, 15, 11, 10, 14, 14, 13, 12, 15, 11, 10, 14, 14, 13, 12, 15, 11, 10, 14, 14, 13, 12, 15, 11, 10, 14, 14, 13, 12],
  [24, 17, 11, 15, 12, 10, 13, 14, 11, 14, 15, 12, 14, 10, 11, 13, 14, 15, 12, 16, 20, 17, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10],
//20
  [24, 17, 12, 13, 14, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 16, 20, 17, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 11, 13],
  [24, 17, 13, 14, 15, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 16, 20, 17, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 11, 10],
  [24, 17, 14, 15, 14, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 16, 20, 17, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 10, 13],
  [24, 17, 15, 14, 10, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 16, 20, 17, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 10],
  [24, 17, 14, 10, 11, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 16, 20, 17, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 11],
  [24, 17, 10, 11, 12, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 16, 20, 17, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10, 14, 15, 12, 11, 13, 14, 10],
  [24, 17, 11, 12, 13, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 16, 20, 17, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11, 10, 14, 13, 12, 14, 15, 11],
  [24, 17, 14, 11, 15, 13, 14, 10, 14, 12, 11, 15, 10, 13, 14, 14, 12, 11, 15, 16, 20, 17, 14, 12, 11, 15, 10, 14, 13, 14, 12, 11, 15, 10, 14, 13, 14, 12, 11, 15, 10, 14, 13, 14, 12, 11, 15, 10, 14, 13],
  [24, 17, 15, 12, 14, 14, 10, 11, 15, 13, 12, 14, 11, 14, 15, 10, 13, 12, 14, 16, 20, 17, 10, 13, 12, 14, 11, 15, 14, 10, 13, 12, 14, 11, 15, 14, 10, 13, 12, 14, 11, 15, 14, 10, 13, 12, 14, 11, 15, 14],
  [24, 17, 14, 13, 10, 15, 11, 12, 14, 14, 13, 10, 12, 15, 14, 11, 14, 13, 10, 16, 20, 17, 11, 14, 13, 10, 12, 14, 15, 11, 14, 13, 10, 12, 14, 15, 11, 14, 13, 10, 12, 14, 15, 11, 14, 13, 10, 12, 14, 15], 
//30 
  [24, 17, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 16, 20, 17, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 11, 10], 
  [24, 17, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 16, 20, 17, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 12, 11],
  [24, 17, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 16, 20, 17, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 14, 13],
  [24, 17, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 16, 20, 17, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 13, 14],
  [24, 17, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 16, 20, 17, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 10, 13],
  [24, 17, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 16, 20, 17, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10],
  [24, 17, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 10, 11, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 12, 10],
  [24, 17, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 10, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12],
  [24, 17, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 16, 20, 17, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13],
  [24, 17, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 16, 20, 17, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 13, 14, 15, 14, 10, 11, 12, 14, 11],
//40
  [24, 17, 12, 13, 14, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 16, 20, 17, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 14, 12, 11, 10, 14, 13, 15, 11, 10],
  [24, 17, 13, 14, 15, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 16, 20, 17, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 13, 12, 11, 15, 14, 14, 10, 14],
  [24, 17, 14, 15, 14, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 16, 20, 17, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 11, 14, 13, 12, 14, 15, 10, 13, 11],
  [24, 17, 15, 14, 10, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 16, 20, 17, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 12, 15, 14, 13, 10, 14, 11, 14, 10],
  [24, 17, 14, 10, 11, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 16, 20, 17, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 14, 15, 14, 11, 10, 12, 13, 12],
  [24, 17, 10, 14, 11, 14, 12, 13, 10, 15, 14, 11, 13, 14, 10, 12, 15, 14, 11, 16, 20, 17, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14, 12, 15, 14, 11, 13, 10, 14],
  [24, 17, 11, 15, 12, 10, 13, 14, 11, 14, 15, 12, 14, 10, 11, 13, 14, 15, 12, 16, 20, 17, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10, 13, 14, 15, 12, 14, 11, 10],
  [24, 17, 12, 14, 13, 11, 14, 15, 12, 10, 14, 13, 15, 11, 12, 14, 10, 14, 13, 16, 20, 17, 14, 10, 14, 13, 15, 12, 11, 14, 10, 14, 13, 15, 12, 11, 14, 10, 14, 13, 15, 12, 11, 14, 10, 14, 13, 15, 13, 14],
  [24, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 20, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18],
  [24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24],
];

/* =========================
   DUNGEON MAP
========================= */

export const dungeonMap = Array.from({ length: WORLD_ROWS }, () =>
  Array.from({ length: WORLD_COLS }, () => TILE_INDEX.DUNGEON_VOID)
);

function carveRoom(map, x, y, w, h) {
  for (let r = y; r < y + h; r++) {
    for (let c = x; c < x + w; c++) {
      map[r][c] = TILE_INDEX.DUNGEON_FLOOR;
    }
  }
}

function addDungeonWalls(map) {
  for (let y = 1; y < WORLD_ROWS - 1; y++) {
    for (let x = 1; x < WORLD_COLS - 1; x++) {
      if (map[y][x] !== TILE_INDEX.DUNGEON_FLOOR) continue;

      if (map[y - 1][x] === TILE_INDEX.DUNGEON_VOID)
        map[y - 1][x] = TILE_INDEX.DUNGEON_BACK_M;

      if (map[y + 1][x] === TILE_INDEX.DUNGEON_VOID)
        map[y + 1][x] = TILE_INDEX.DUNGEON_FRONT;

      if (map[y][x - 1] === TILE_INDEX.DUNGEON_VOID)
        map[y][x - 1] = TILE_INDEX.DUNGEON_SIDE_L;

      if (map[y][x + 1] === TILE_INDEX.DUNGEON_VOID)
        map[y][x + 1] = TILE_INDEX.DUNGEON_SIDE_R;
    }
  }
}

// Carve dungeon layout
carveRoom(dungeonMap, 10, 10, 8, 6);
carveRoom(dungeonMap, 22, 10, 10, 6);
carveRoom(dungeonMap, 22, 22, 12, 8);
addDungeonWalls(dungeonMap);

/* =========================
   ACTIVE WORLD HANDLING
========================= */

let activeWorld = worldMap;

export function setActiveWorld(map) {
  activeWorld = map;
}

export function setupWorld() {
  activeWorld = worldMap;
}

export function isColliding(nextX, nextY, size, npcs = [], objects = []) {
  const half = size / 2;

  // --- TILE COLLISION ---
  const leftTile   = Math.floor((nextX - half) / TILE_SIZE);
  const rightTile  = Math.floor((nextX + half - 1) / TILE_SIZE);
  const topTile    = Math.floor((nextY - half) / TILE_SIZE);
  const bottomTile = Math.floor((nextY + half - 1) / TILE_SIZE);

  for (let ty = topTile; ty <= bottomTile; ty++) {
    for (let tx = leftTile; tx <= rightTile; tx++) {
      const tile = getTile(tx, ty);

      if (tile !== null && SOLID_TILES.includes(tile)) {
        console.log(
          "[TILE COLLISION]",
          "tile:", tile,
          "at:", tx, ty,
          "player:", Math.floor(nextX / TILE_SIZE), Math.floor(nextY / TILE_SIZE)
        );

        return true;
      }
    }
  }

  // --- NPC COLLISION ---
  for (const npc of npcs) {
    if (!npc || npc.isDead) continue;
    if (Math.abs(npc.x - nextX) < size && Math.abs(npc.y - nextY) < size) {
      return true;
    }
  }

  // --- OBJECT COLLISION ---
  const playerBox = {
    x: nextX - half,
    y: nextY - half,
    width: size,
    height: size
  };

  for (const obj of objects) {
    if (!obj.getCollisionBox) continue;

    const box = obj.getCollisionBox();

    if (
      playerBox.x < box.x + box.width &&
      playerBox.x + playerBox.width > box.x &&
      playerBox.y < box.y + box.height &&
      playerBox.y + playerBox.height > box.y
    ) {
      return true;
    }
  }
}

export function getTile(tx, ty) {
  if (tx < 0 || ty < 0 || tx >= WORLD_COLS || ty >= WORLD_ROWS) return null;
  return activeWorld[ty][tx];
}

export function worldToTile(value) {
  return Math.floor(value / TILE_SIZE);
}

/* =========================
   COLLISION HELPERS
========================= */

export function isSolidTile(x, y, size) {
  const left   = worldToTile(x - size / 2);
  const right  = worldToTile(x + size / 2);
  const top    = worldToTile(y - size / 2);
  const bottom = worldToTile(y + size / 2);

  return (
    SOLID_TILES.includes(getTile(left, top)) ||
    SOLID_TILES.includes(getTile(right, top)) ||
    SOLID_TILES.includes(getTile(left, bottom)) ||
    SOLID_TILES.includes(getTile(right, bottom))
  );
}

/* =========================
   TILE ANIMATION
========================= */

let animationTimer = 0;
let animationFrame = 0;

const ANIMATED_TILES = {
  20: { frames: [20, 21, 22, 23], speed: 0.2 }
};

export function updateWorldAnimation(dt) {
  animationTimer += dt;
  if (animationTimer >= 0.2) {
    animationFrame = (animationFrame + 1) % 4;
    animationTimer = 0;
  }
}

/* =========================
   DRAW WORLD
========================= */

export function drawWorld(ctx, camera) {
  if (!isImageLoaded) return;

  for (let row = 0; row < WORLD_ROWS; row++) {
    for (let col = 0; col < WORLD_COLS; col++) {
      let tile = activeWorld[row][col];
      let tileToDraw = tile;

      if (ANIMATED_TILES[tile]) {
        const anim = ANIMATED_TILES[tile];
        const offset = (row + col) % anim.frames.length;
        tileToDraw =
          anim.frames[(animationFrame + offset) % anim.frames.length];
      }

      const sx = (tileToDraw % TILES_PER_ROW) * TILE_SIZE;
      const sy = Math.floor(tileToDraw / TILES_PER_ROW) * TILE_SIZE;

      ctx.drawImage(
        tileImage,
        sx, sy, TILE_SIZE, TILE_SIZE,
        col * TILE_SIZE,
        row * TILE_SIZE,
        TILE_SIZE,
        TILE_SIZE
      );
    }
  }
}